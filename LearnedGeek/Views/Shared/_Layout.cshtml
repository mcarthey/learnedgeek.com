@using LearnedGeek.Models
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    @{
        var seo = ViewBag.Seo as SeoMetadata;
        var pageTitle = seo?.Title ?? ViewData["Title"]?.ToString() ?? "Learned Geek";
        var fullTitle = pageTitle == "Learned Geek" ? pageTitle : $"{pageTitle} - Learned Geek";
        var description = seo?.Description ?? "Learning by building. Solving problems across disciplines.";
        var image = seo?.Image ?? "/img/learned-geek-og.png";
        var imageUrl = image.StartsWith("http") ? image : $"https://learnedgeek.com{image}";
        var url = seo?.Url ?? $"https://learnedgeek.com{Context.Request.Path}";
        var contentType = seo?.Type ?? "website";
    }

    <title>@fullTitle</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="@fullTitle" />
    <meta name="description" content="@description" />
    <link rel="canonical" href="@url" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="@contentType" />
    <meta property="og:url" content="@url" />
    <meta property="og:title" content="@fullTitle" />
    <meta property="og:description" content="@description" />
    <meta property="og:image" content="@imageUrl" />
    <meta property="og:site_name" content="Learned Geek" />
    @if (contentType == "article" && seo?.PublishedTime.HasValue == true)
    {
        <meta property="article:published_time" content="@seo.PublishedTime.Value.ToString("yyyy-MM-ddTHH:mm:ssZ")" />
        @if (seo?.Tags != null)
        {
            @foreach (var tag in seo.Tags)
            {
                <meta property="article:tag" content="@tag" />
            }
        }
    }

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="@url" />
    <meta name="twitter:title" content="@fullTitle" />
    <meta name="twitter:description" content="@description" />
    <meta name="twitter:image" content="@imageUrl" />

    <link rel="icon" type="image/png" href="~/img/learned-geek-logo.png" />
    <link rel="alternate" type="application/rss+xml" title="Learned Geek RSS Feed" href="/feed.xml" />
    <link rel="alternate" type="application/json" title="Learned Geek JSON Feed" href="/feed.json" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- JSON-LD Structured Data -->
    @if (contentType == "article" && seo != null)
    {
        <script type="application/ld+json">
        {
            "@@context": "https://schema.org",
            "@@type": "BlogPosting",
            "headline": "@Html.Raw(System.Text.Json.JsonEncodedText.Encode(pageTitle).ToString())",
            "description": "@Html.Raw(System.Text.Json.JsonEncodedText.Encode(description).ToString())",
            "image": "@imageUrl",
            "url": "@url",
            "datePublished": "@seo.PublishedTime?.ToString("yyyy-MM-ddTHH:mm:ssZ")",
            "author": {
                "@@type": "Person",
                "name": "Learned Geek"
            },
            "publisher": {
                "@@type": "Organization",
                "name": "Learned Geek",
                "logo": {
                    "@@type": "ImageObject",
                    "url": "https://learnedgeek.com/img/learned-geek-logo.png"
                }
            }
        }
        </script>
    }
    else
    {
        <script type="application/ld+json">
        {
            "@@context": "https://schema.org",
            "@@type": "WebSite",
            "name": "Learned Geek",
            "url": "https://learnedgeek.com",
            "description": "@Html.Raw(System.Text.Json.JsonEncodedText.Encode(description).ToString())"
        }
        </script>
    }

    <script>
        // Prevent flash of wrong theme on page load
        // Only use dark mode if user explicitly chose it (ignore system preference)
        (function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
</head>
<body class="min-h-screen flex flex-col bg-white text-neutral-900 dark:bg-neutral-900 dark:text-neutral-100 transition-colors">
    <partial name="_Navigation" />

    <main class="flex-1 pt-16">
        @RenderBody()
    </main>

    <partial name="_Footer" />

    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
